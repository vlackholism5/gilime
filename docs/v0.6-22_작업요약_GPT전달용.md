# v0.6-22 작업 요약 (GPT 전달용)

아래 블록 전체를 복사해 GPT에 붙여넣으면 됩니다.

---

```
[작업 완료] v0.6-22 PARSE_MATCH 품질 지표 저장 + doc 화면 노출

[프로젝트] GILIME_MVP_01 (PHP + MySQL, XAMPP)
[레포] https://github.com/vlackholism5/gilime (main 브랜치)
[현재 버전] v0.6-22

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[v0.6-22 핵심 변경]

1) 신규 테이블 추가
   - shuttle_parse_metrics
   - 목적: PARSE_MATCH 성공 job_id 기준, route_label 단위 품질 지표 저장
   - 주요 컬럼:
     source_doc_id, parse_job_id, route_label,
     cand_total, auto_matched_cnt, low_confidence_cnt, none_matched_cnt, alias_used_cnt,
     high_cnt, med_cnt, low_cnt, none_cnt, created_at
   - 인덱스:
     UNIQUE(parse_job_id, route_label)
     INDEX(source_doc_id, route_label)

2) run_job.php 반영
   - PARSE_MATCH 성공 + candidate INSERT 완료 직후
   - DB 집계 쿼리로 route별 metrics 계산 후 UPSERT 저장
   - 분류 규칙(v0.6-18 동일):
     HIGH: exact, alias_live_rematch, alias_exact
     MED : normalized, alias_normalized
     LOW : like_prefix
     NONE: match_method IS NULL
   - metrics 저장 실패는 비치명 처리(error_log), PARSE_MATCH 성공은 유지

3) doc.php 반영
   - Jobs 테이블 아래에 "PARSE_MATCH Metrics (latest job)" 섹션 추가
   - latest_parse_job_id 기준 route별 metrics 테이블 노출
   - 컬럼:
     route_label, cand_total, auto_matched_cnt, low_confidence_cnt,
     none_matched_cnt, alias_used_cnt, HIGH/MED/LOW/NONE

4) 검증 SQL 추가
   - sql/v0.6-22_validation.sql
   - 8개 쿼리: 테이블 존재, latest job, row count, 집계 일치, 분포 일치, LOW/NONE 일치, UPSERT 중복 여부
   - route_label 콜레이션 충돌 대비(utf8mb4_unicode_ci 강제 비교) 반영

5) 문서 업데이트
   - README.md: v0.6-22 섹션 추가
   - docs/STATUS_FOR_GPT.md: 현재 버전 v0.6-22, SoT 항목 8번(metrics 저장) 추가

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[실행/검증 결과 요약]

- shuttle_parse_metrics 테이블 생성 확인 완료
- validation 실행 결과(최신 job_id=16):
  - route_cnt=1, metrics_cnt=1 (일치)
  - metrics vs candidate 집계 일치
    cand_total=3, auto_matched_cnt=3, high_cnt=3, med/low/none=0
  - 분포 합계 일치: high+med+low+none = cand_total
  - low/none 비교 일치
  - UPSERT 중복 0건

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[SoT (변경 금지) 유지]

1. latest PARSE_MATCH 스냅샷 기준 후보 표시
2. stale 후보 승인/거절 차단
3. promote는 latest만
4. route_stop 스냅샷 누적 (is_active 0/1)
5. alias 등록 시 latest 1건만 live rematch
6. 추천 canonical은 only_unmatched=1에서만
7. LOW 필터 + Promote 경고 유지
8. v0.6-21 게이트(LOW 승인 체크, alias 검증) 유지
9. v0.6-22는 metrics 저장/조회만 추가 (매칭 로직 불변)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[SQL/Import 실행 원칙]

- DDL/검증쿼리/데이터 Import/UPDATE는 Cursor PC 앱(터미널/Workbench)에서만 실행
- GPT 대화에서는 실행 결과(row count, 샘플, 에러)만 공유

```

---

위 내용을 GPT에 붙여넣고, 다음 작업 지시를 요청하면 됩니다.
