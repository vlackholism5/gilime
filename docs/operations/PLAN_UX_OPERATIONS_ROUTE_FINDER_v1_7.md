# 길라임 길찾기·운영·UX 통합 플랜 (v1.7)

## 개요

운영 가능성, 긴급 상황 UX, 사용자(User) 지도 서비스 UI/UX를 R5 UX/서비스기획 관점에서 통합 설계하고, 화면설계까지 포함한 실행 플랜을 정의한다.

---

## Part 1. 운영 가능성 (장애/유지보수)

### 1.1 현재 리스크

| 리스크 | 영향 | 대응 상태 |
|--------|------|-----------|
| GPT 검수 API 실패 | 검수 불가, 사용자 대기 | run_gpt_review 실패 시 플래시 메시지, 수동 일괄 반영 fallback |
| PDF 파싱 실패 | 후보 미생성 | parse_status=failed, 수동 등록 플로우 없음 |
| Python/OCR 미설치 | 텍스트 없는 PDF 처리 불가 | run_ocr_extract null 반환, 에러 메시지 |
| DB 장애 | 전체 서비스 중단 | DB 연결 실패 시 5xx, 재시도 없음 |

### 1.2 보완 액션 (운영 가능성 강화)

| No | 액션 | Owner | Output | Due |
|----|------|-------|--------|-----|
| 1 | ** Fallback 문서화** | Tech Lead | `docs/operations/OPERATIONS_FALLBACK_v1_7.md` — GPT 실패 시 수동 검수, 파싱 실패 시 수동 등록 절차 | 1주 |
| 2 | **헬스체크 엔드포인트** | Tech Lead | `public/api/health.php` — DB 연결, 필수 테이블 존재 여부 | 1주 |
| 3 | **에러 로그 정책** | Data Engineer | PHP error_log, 실패 job 로그(shuttle_doc_job_log) 연동 규칙 | 1주 |
| 4 | **수동 정류장 등록 UI** | Tech Lead | 매칭 실패 시 Admin에서 raw_stop_name → stop_id 수동 지정 후 저장 | 2주 |
| 5 | **데이터 정합성 검증** | Data Engineer | `scripts/validate_data_integrity.php` — route_stop 누락, orphan 후보 등 | 2주 |

### 1.3 운영 Runbook (초안)

- **GPT 검수 실패** → import_candidate_review로 CSV/JSON 수동 업로드
- **파싱 실패** → OCR 설정 확인, 또는 수동 노선 등록(확장 시)
- **DB 연결 실패** → config.local.php, MySQL 프로세스 확인

---

## Part 2. 긴급 상황 UX

### 2.1 시나리오

| 상황 | 사용자 목표 | 제약 |
|------|-------------|------|
| 파업/셔틀 | "지금 갈 수 있는 셔틀 노선·정류장" | 정보 산재, 갱신 빈도 불명 |
| 행사/공사 | "대체 경로가 있는지" | 공지 문서 형식 제각각 |
| 긴급 이동 | "출발지→도착지 최단 경로" | 시간 압박, 모바일居多 |

### 2.2 긴급 상황 UX 원칙

| 원칙 | 설명 |
|------|------|
| **최소 클릭** | 경로 조회 3클릭 이내 완결 |
| **한눈에** | 임시 셔틀 포함 여부, 운행 시간대 즉시 표시 |
| **오프라인 대비** | 주요 노선 정보 캐시/스크린샷 가능 |
| **접근성** | 긴급 시 콘트라스트, 터치 영역 확대 |
| **실패 시 대안** | "경로 없음" 시 근처 정류장·대체 수단 안내 |

### 2.3 긴급 상황 전용 UI 요소

| 요소 | 용도 |
|------|------|
| **긴급 배너** | "OO 파업 중 — 임시 셔틀 17개 노선 운영" (활성 이슈 시) |
| **빠른 검색** | 출발·도착 2칸 + [검색] 1버튼 |
| **임시 셔틀 뱃지** | 노선/정류장에 "임시" 표시로 구분 |
| **운행시간 강조** | 06:00~22:00 등 첫차·막차 명시 |
| **결과 없음 대안** | "근처 정류장 보기", "지하철 환승 안내" 등 |

---

## Part 3. 사용자(User) 지도 서비스 UI/UX

### 3.1 사용자 인식: "길찾기"

| 기대 | 구현 방향 |
|------|------------|
| 출발지·도착지 입력 | 검색/자동완성 또는 지도 클릭 |
| 경로 표시 | 지도 폴리라인 + 정류장 마커 |
| 소요시간·거리 | 노선별 예상 (배차간격 기반) |
| 대체 경로 | 1개 이상 경로 제시 (후속) |

### 3.2 정보 구조

```
[출발지] [도착지] [검색]
    ↓
[경로 결과 N건]
  - 경로 1: 버스 OO번 → OO역 (임시 셔틀) (예상 NN분)
  - 경로 2: ...
    ↓
[지도] 경로 폴리라인 + 정류장
[상세] 정류장별 승차·하차·도보
```

**UI 참조:** 네이버 지도 — 장소/버스정류장 탭 검색, 경로 필터 탭, 경로 카드 타임라인. 상세: [docs/ux/NAVER_MAP_UI_ADOPTION_v1_8.md](../ux/NAVER_MAP_UI_ADOPTION_v1_8.md)

### 3.3 User vs Admin 구분

| 구분 | Admin | User |
|------|-------|------|
| 경로 | `/admin/` | `/user/` |
| 길찾기 | 없음 | `/user/journey.php` 또는 `/user/route_finder.php` |
| 노선 등록 | PDF 업로드, 검수 | 구독만 |
| 지도 | 미사용 | 지도 중심 |

---

## Part 4. 화면설계 (R5 UX/서비스기획)

### 4.1 화면 목록

| 화면 ID | 화면명 | 경로 | 우선순위 |
|---------|--------|------|----------|
| U-RF-01 | 길찾기 메인 | /user/route_finder.php | P0 |
| U-RF-02 | 경로 결과 목록 | (메인 내 섹션) | P0 |
| U-RF-03 | 경로 상세(정류장) | (메인 내 패널 또는 모달) | P0 |
| U-RF-04 | 지도 뷰 | (메인 내 또는 별도 탭) | P1 |
| U-HOME | 홈 | /user/home.php | 기존 |
| U-ROUTES | 노선 | /user/routes.php | 기존 |
| U-ALERTS | 알림 | /user/alerts.php | 기존 |

### 4.2 U-RF-01 길찾기 메인 (와이어프레임)

```
┌─────────────────────────────────────────────────────────┐
│ [길라임]  홈  노선  알림  [길찾기]                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  출발지                                                  │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 정류장명, 역명, 주소 검색...                      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  도착지                                                  │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 정류장명, 역명, 주소 검색...                      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [✓] 임시 셔틀 포함                                      │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │              [ 경로 찾기 ]                       │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  경로 결과                                     (접기)   │
│  ─────────────────────────────────────────────────     │
│  ┌─ 경로 1 ───────────────────────────────────────┐    │
│  │ 🚌 동작1(임시) · 임시 셔틀                       │    │
│  │ 노량진역 → 동작구청 → 성대시장 → ... (7정류장)   │    │
│  │ 예상 20분 · 배차 20분 · 06:00~22:00             │    │
│  │ [상세] [지도]                                    │    │
│  └─────────────────────────────────────────────────┘    │
│  ┌─ 경로 2 ───────────────────────────────────────┐    │
│  │ ...                                             │    │
│  └─────────────────────────────────────────────────┘    │
│                                                         │
│  ※ 경로 없음: [근처 정류장 보기] [문의하기]              │
└─────────────────────────────────────────────────────────┘
```

### 4.3 U-RF-02 경로 결과 목록 (상세)

| 필드 | 표시 | 비고 |
|------|------|------|
| 노선명 | 동작1(임시), 641번 등 | 임시 셔틀 뱃지 |
| 경유지 | 정류장 3~5개 요약 + "…" | 클릭 시 전체 펼침 |
| 예상 소요 | 배차×경유 수 또는 고정 | Phase 1은 단순 추정 |
| 운행시간 | 06:00~22:00 | first_bus, last_bus |
| 배차간격 | 20분 | headway_min |
| 액션 | 상세, 지도 | |

### 4.4 U-RF-03 경로 상세 (정류장 순서)

```
┌─ 동작1(임시) 상세 ─────────────────────────────────┐
│ 1. 노량진역 (승차)                                 │
│ 2. 동작구청                                        │
│ 3. 성대시장                                        │
│ 4. 신대방삼거리                                    │
│ 5. 보라매병원입구                                  │
│ 6. 롯데백화점 (하차)                               │
│                                                    │
│ 운행 06:00~22:00 · 배차 20분 · 7.0km               │
└────────────────────────────────────────────────────┘
```

### 4.4 U-RF-04 지도 뷰 (Phase 2)

| 요소 | 설명 |
|------|------|
| 베이스 | Kakao/Naver/Leaflet 등 (선택) |
| 마커 | 출발(녹색), 도착(빨강), 경유 정류장(회색) |
| 폴리라인 | 경로 순서대로 연결 |
| 툴팁 | 정류장명, seq |
| 줌 | 경로 전체가 보이도록 자동 fit |

---

## Part 5. 실행 플랜 (통합)

### Phase 1: 기반 (2주)

| 주 | 액션 | Owner | 산출물 |
|----|------|-------|--------|
| 1 | 운영 Fallback 문서화 | Tech Lead | OPERATIONS_FALLBACK_v1_7.md |
| 1 | health.php | Tech Lead | public/api/health.php |
| 1 | U-RF-01~03 와이어프레임 확정 | UX | WIREFRAME_ROUTE_FINDER_v1.md |
| 2 | route_finder.php 기본 UI | Tech Lead | 출발/도착 입력, 검색 버튼 |
| 2 | 경로 조회 API(내부) | Tech Lead | 경로 결과 JSON 반환 |

### Phase 2: 화면 완성 (2주)

| 주 | 액션 | Owner | 산출물 |
|----|------|-------|--------|
| 3 | 경로 결과 목록·상세 UI | Tech Lead | U-RF-02, U-RF-03 |
| 3 | 임시 셔틀 포함 필터 | Tech Lead | 체크박스 연동 |
| 4 | 긴급 배너·뱃지 | UX/Tech | 배너, "임시" 뱃지 |
| 4 | 결과 없음 대안 | UX | "근처 정류장" 링크 |

### Phase 3: 운영·지도 (2주)

| 주 | 액션 | Owner | 산출물 |
|----|------|-------|--------|
| 5 | 수동 정류장 등록 UI | Tech Lead | Admin fallback |
| 5 | 지도 뷰 (선택) | Tech Lead | U-RF-04 |
| 6 | 데이터 정합성 검증 | Data Engineer | validate_data_integrity.php |
| 6 | 운영 Runbook 보완 | PM | 최종 Runbook |

---

## Part 6. R5 UX 체크리스트

| 항목 | 기준 | 확인 |
|------|------|------|
| 길찾기 진입 | 홈·네비에서 1클릭 | [ ] |
| 검색 완결 | 출발·도착 입력 후 3클릭 이내 | [ ] |
| 긴급 구분 | 임시 셔틀 즉시 인지 | [ ] |
| 모바일 | 터치 영역 44px 이상 | [ ] |
| 접근성 | 키보드만으로 검색 가능 | [ ] |
| 실패 안내 | "경로 없음" 시 대안 제시 | [ ] |

---

## Part 7. 의존 관계

```
[운영 Fallback 문서] ──────────────────────┐
[health.php]                               │
[wireframe 확정] ──→ [route_finder.php UI] ──→ [경로 API]
[PARSE_TEMP_SHUTTLE] ──→ [shuttle_temp_route_stop] ──┘
[철도역 인접 정류장] ──→ (Phase 2 다중 수단)
```

---

*문서 버전: v1.7. 2026-02 기준.*
