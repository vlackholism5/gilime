# v1.4-10 Smoke Checklist

PC에서 DDL 실행 후 아래 항목을 확인하세요.

## 1) Subscribe / Unsubscribe state correct

- /user/routes.php: Subscribe 클릭 시 구독 등록, 버튼이 Unsubscribe로 바뀌고 "(Subscribed)" 표시. Unsubscribe 클릭 시 해제. 새로고침 시 상태 유지.

## 2) Alerts derived generation inserts events

- sql/v1.4-07_route_label.sql 실행 후, `php scripts/run_alert_generate_from_metrics.php` (또는 Windows: `C:\xampp\php\php.exe scripts\run_alert_generate_from_metrics.php`) 실행.
- shuttle_parse_metrics 기준 직전 job 대비 none_matched_cnt / low_confidence_cnt 증가 시 "NONE 증가", "LOW 증가" 이벤트가 app_alert_events에 삽입됨. 출력: "run_alert_generate_from_metrics: inserted N event(s)."
- /user/alerts.php에서 해당 이벤트 표시(route_label·Review 링크 있음).

## 3) Deliveries logged

- /user/alerts.php 로드 전후로 `SELECT COUNT(*) FROM app_alert_deliveries` 실행 시, 페이지 조회 후 건수 증가.
- (v1.4-06: UNIQUE (user_id, alert_event_id, channel) 적용 후 동일 사용자가 같은 알림을 다시 볼 때는 INSERT가 아닌 UPDATE로 처리됨.)

## 4) Home subscribed list + Alerts filters

- /user/home.php: 구독 1건 이상일 때 "Subscribed routes (max 10)" 섹션에 노선 링크 표시. 링크 클릭 시 /user/alerts.php?route_label=XXX 로 이동.
- /user/alerts.php: type 필터(strike/event/update), "subscribed only" on/off, Review 컬럼(route_review 또는 doc 링크) 동작.

## 5) Admin pages unchanged

- /admin/index.php, /admin/review_queue.php, /admin/route_review.php 등 기존 관리자 플로우·SoT/게이트/매칭 로직 변경 없음.
