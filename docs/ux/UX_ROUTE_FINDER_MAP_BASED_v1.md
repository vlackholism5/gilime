# 길찾기 지도 기반 와이어프레임 확장 v1

## 목적

기존 “경로 찾기” 카드 UI(출발지/도착지 텍스트 입력, 임시 셔틀 포함, 경로 찾기 버튼)를 유지하면서 **지도 영역**을 추가하고, 출발/도착 선택·경로 결과를 지도와 연동하는 화면 구조와 상태를 정의한다.  
MVP 범위: 서울 대중교통·임시셔틀. 네이버지도/카카오맵 등 참조 가능.

**기준 문서:** [Gilime_User_Wireframe_MVP_v2](../SOT/Gilime_User_Wireframe_MVP_v2.md), [길찾기_와이어프레임_회의_아젠다별_정리](../CHAT_EXPORTS/길찾기_와이어프레임_회의_아젠다별_정리.md)

---

## 1. 화면 레이아웃 (지도 기반 확장)

### 1.1 전체 구조

- **상단:** 네비게이션(홈 / 이슈 / 길찾기 / 마이노선), 앱 타이틀 “길라임”, 안내 문구
- **경로 찾기 카드:** 기존 유지
  - 섹션 제목: “경로 찾기”
  - 출발지 입력 (플레이스홀더: 정류장명, 역명, 주소 검색…)
  - 도착지 입력 (동일)
  - 체크박스: “임시 셔틀 포함”
  - 버튼: “경로 찾기”
  - (선택) 길찾기 가능 정류장 예시, 경로 나오는 예시 등 접이 영역
- **지도 영역:** 카드 **아래** 배치 (또는 카드를 반투명/접이식으로 해서 그 아래 지도 노출)
  - 기본: 현재 위치 중심 또는 서울 기본 확대 레벨
  - 출발/도착 선택 시: 해당 좌표 포함하도록 뷰 조정

### 1.2 레이아웃 옵션

| 옵션 | 설명 | 비고 |
|------|------|------|
| A. 카드 하단 고정 + 지도 | 카드는 상단 고정, 스크롤 시 그 아래에 지도 | 카드가 화면 일부만 차지, 지도가 메인 |
| B. 카드 접이식 + 지도 | 카드 접으면 지도 전체 화면, 펼치면 카드+지도 | 지도 활용 극대화 |
| C. 카드 오버레이 + 지도 배경 | 지도가 전체 배경, 카드는 지도 위 플로팅 카드 | 지도가 항상 보임 |

**권장:** A 또는 C. 기존 카드 UI를 그대로 두고 그 아래(또는 배경)에 지도 영역을 두는 방식.

---

## 2. 출발/도착과 지도 연동

### 2.1 입력 방식 (둘 다 지원)

- **텍스트 검색(기존 유지):** 정류장명·역명·주소 검색 → 자동완성 리스트 → 선택
- **지도 선택:** 지도 탭/클릭으로 위치 지정
  - 마커 클릭: 해당 정류장/장소를 출발 또는 도착으로 설정
  - 또는 “출발지로 설정” / “도착지로 설정” 컨텍스트 메뉴

### 2.2 연동 규칙

- 텍스트로 출발/도착 선택 시 → 해당 좌표에 **마커** 표시, 필요 시 지도 뷰가 해당 점을 포함하도록 이동/줌
- 지도에서 위치 선택 시 → 해당 좌표가 출발 또는 도착 필드에 반영(주소/정류장명이 있으면 텍스트 표시, 없으면 “지도에서 선택한 위치” 등)
- 출발지 마커: 한 종류(예: 파랑), 도착지 마커: 다른 종류(예: 빨강)로 구분

### 2.3 컴포넌트

| 컴포넌트 | 용도 |
|----------|------|
| MapView | 지도 영역 (네이버/카카오 등 SDK 연동) |
| OriginMarker / DestMarker | 출발/도착 마커 (드래그 가능 시 위치 변경) |
| SearchCard | 기존 경로 찾기 카드 (출발/도착 입력, 임시 셔틀 포함, 경로 찾기 버튼) |
| PlaceAutocomplete | 정류장명·역명·주소 자동완성 (기존 유지, 선택 결과를 카드 + 지도에 반영) |

---

## 3. 경로 결과의 지도 표시

### 3.1 “경로 찾기” 실행 후

- **지도:** 검색된 경로를 **폴리라인**으로 표시
  - 세그먼트별 구분 권장: 도보(점선), 버스(실선), 지하철(실선·다른 색), 임시셔틀(예: 보라) — [Gilime_User_Wireframe_MVP_v2] 화면 4 스타일 참조
- **리스트/카드:** 기존처럼 경로 요약 바, 정렬, 경로 카드 리스트는 유지 (지도 위 바텀시트 또는 카드 영역)
- 선택한 경로가 있으면 해당 경로만 지도에 강조, 나머지는 옅게 또는 생략

### 3.2 상태별 지도 동작

| 상태 | 지도 표시 |
|------|-----------|
| IDLE | 현재 위치 또는 기본 중심, 출발/도착 마커만 있을 수 있음 |
| SEARCHING | 로딩 표시, 기존 마커 유지 |
| ROUTE_LOADED | 전체 경로 폴리라인 + 출발/도착 마커, 선택 경로 강조 |
| GUIDING | 현재 구간 강조, 도보/버스/지하철/셔틀 시각 구분 유지 |
| END | 최종 경로 유지 또는 초기화 |

---

## 4. 상태 머신 (지도 뷰 반영)

기존 [Gilime_User_Wireframe_MVP_v2] 상태 머신 유지, 지도와의 동기화만 추가.

- **IDLE** → **SEARCHING** → **ROUTE_LOADED** → **GUIDING** → **END**
- 확장: ISSUE_DETECTED, REROUTE_AVAILABLE, SUBSCRIBED_ROUTE, SHUTTLE_ACTIVE

**지도 동기화:**

- ROUTE_LOADED: 지도에 경로선·마커 표시, 뷰를 경로 전체가 보이도록 조정(옵션)
- GUIDING: 현재 스텝에 해당하는 구간 강조, 필요 시 지도 중심을 현재 위치로 이동
- 재탐색/이슈: 새 경로 로드 시 기존 폴리라인 갱신

---

## 5. 컴포넌트 요약 (지도 기반 확장)

| 컴포넌트 | 용도 |
|----------|------|
| MapView | 지도 영역, 마커·폴리라인 렌더링 |
| OriginMarker / DestMarker | 출발/도착 마커 |
| RoutePolyline | 경로선 (세그먼트별 스타일: 도보/버스/지하철/셔틀) |
| SearchCard | 출발/도착 입력, 임시 셔틀 포함, 경로 찾기 (기존) |
| RouteCard, TransitBadge, ArrivalTag | 기존 유지 |
| BottomSheet | 정렬 옵션, 정류장 상세 (기존) |
| MapOverlay | 경로·현재 단계 오버레이 (기존 SOT와 동일 개념) |
| FloatingTimer | 재탐색/구독 (기존) |

---

## 6. 데이터 흐름 (변경 없음)

USER_INPUT → ISSUE_CHECK → ROUTE_ENGINE(NORMAL_TRANSIT, SHUTTLE_OVERLAY) → SCORE_ENGINE(TIME, TRANSFER, ISSUE_IMPACT) → RESULT_RENDER  

지도 기반 확장에서는 **RESULT_RENDER** 단계에서 텍스트/카드뿐 아니라 지도에 마커·폴리라인을 그리는 처리가 추가된다.

---

## 7. 구현 참고 (MVP)

- **지도 SDK:** 네이버지도 API / 카카오맵 API 등 (서울 대중교통·임시셔틀 MVP에 맞게 선택)
- **좌표:** 출발/도착·경로 세그먼트 좌표는 API v1 경로 검색 응답과 동일한 좌표계 사용
- **접근성:** 지도 없이도 출발/도착 입력 + 경로 카드만으로 흐름 완결 가능하도록 유지 (기존 [NAVER_MAP_UI_SYSTEM_APPLY_v1_0] “지도 없이도 UX 무너지지 않음” 원칙과 병행 가능)

### 7.1 Leaflet 구현 가능 범위 (키 없이 운영)
- 베이스 지도 렌더링
- 출발/도착 마커 동기화 (자동완성 선택 이벤트 기반)
- 결과 카드 선택 시 경로선 하이라이트
- 하단 결과 시트 + 정렬 모달 UI
- 정렬 옵션 URL 파라미터 연동(`route_sort`, `stair_avoid`)

### 7.2 API 키 필요 범위 (후속)
- 네이버 지도 고유 타일/POI 스타일
- 네이버 대중교통 경로선/환승 안내 레이어
- 네이버 길안내 UX(실시간 안내, 도착정보 카드) 1:1 재현

---

## 8. 연계 문서

- [Gilime_User_Wireframe_MVP_v2](../SOT/Gilime_User_Wireframe_MVP_v2.md)
- [길찾기_와이어프레임_회의_아젠다별_정리](../CHAT_EXPORTS/길찾기_와이어프레임_회의_아젠다별_정리.md)
- [NAVER_MAP_UI_SYSTEM_APPLY_v1_0](NAVER_MAP_UI_SYSTEM_APPLY_v1_0.md)
- 실행 플랜: `.cursor/plans/길찾기_와이어프레임_회의_정리_및_실행_플랜_e09c9524.plan.md`
