# v1.7-04 Gate (Approval + Publish guard)

## Gate 항목

| # | 항목 | Evidence |
|---|------|----------|
| **G1** | 문서/파일 OK | docs/APPROVAL_FLOW_v1_7.md, v1.7-04_smoke.md, v1.7-04_GATE.md, alert_ops 상태 뱃지·Publish guard, sql/v1.7-04_validation.sql, STATUS/README. |
| **G2** | 상태 뱃지 | 목록에 draft / published 라벨 표시. |
| **G3** | Publish guard | target_user_cnt=0 이면 Publish 차단(blocked_no_targets). target_user_cnt>0 이면 Publish 허용(published). |
| **G4** | flash 문구 | published, blocked_no_targets, failed 표시. |
| **G5** | user 노출 | 발행된 이벤트만 user/alerts에 노출 유지. |

## Evidence (실행 결과)

- **쿼리 1 (draft_cnt / published_cnt):** 0 / 7.
- **쿼리 2 (최근 5건):** id 8,6,5,4,3 · 모두 published_at 존재. id=3은 ref_type/ref_id/route_label NULL(route 아님).
- **쿼리 3 (EID=8 target_user_cnt):** 2 → Publish guard 통과(차단 없음).

## Evidence 템플릿

- draft 생성 → draft_only 확인 → preview cnt > 0 → Publish → flash=published, published_only·user 노출.
- target_user_cnt=0 draft → Publish → flash=blocked_no_targets, DB published_at 변경 없음.

## Gate 판정 (완료)

**Evidence 요약**
- 쿼리1: draft_cnt=0, published_cnt=7
- 쿼리2: 최근 5건(id 8,6,5,4,3) 모두 published_at 존재(발행 상태). id=3은 route 이벤트 아님(ref_type/ref_id/route_label NULL).
- 쿼리3: EID=8 target_user_cnt=2 → Publish guard 조건(>0) 충족.

**Gate 결론:** G1~G5 OK → v1.7-04 PASS. 다음 단계: v1.7-05 착수 가능.

## Non-goals (v1.7-04)

- deliveries 선생성·outbound·타겟팅 정교화·role/권한 금지.
